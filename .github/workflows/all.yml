name: Compile
on:
  pull_request: {}
  push:
    branches:
      - main
jobs:

  build-windows:
    runs-on: windows-latest

    strategy:
      matrix:
        python-version: [3.9]

    steps:
    # - uses: actions/checkout@v2
    #   with:
    #     submodules: true

    # - name: Setup Python ${{ matrix.python-version }}
    #   uses: actions/setup-python@v2
    #   with:
    #     python-version: ${{ matrix.python-version }}

    # - name: Install Python dependencies
    #   run: |
    #     python -m pip install --upgrade pip
    #     pip install requests

    - name: Add msbuild to PATH
      uses: microsoft/setup-msbuild@v1.0.3

    - name: Get CMake
      uses: lukka/get-cmake@latest

    - name: Build Windows (Release)
      run: |
        mkdir build_release
        cmake -DCMAKE_BUILD_TYPE=Release -Bbuild_release
        cd build_release
        msbuild ChucKDesignerCHOP.sln /property:Configuration=Release

  build-macos:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        python-version: [3.9]
        os: [macos-10.15]
    steps:
    - uses: actions/checkout@v2
      with:
        submodules: true

    - name: Get CMake
      uses: lukka/get-cmake@latest

    - name: Build libsamplerate
      run: |
        cd thirdparty/libsamplerate
        mkdir build_release
        cmake -DCMAKE_BUILD_TYPE=Release -Bbuild_release
        make --directory=build_release

    - name: Build MacOS (Release)
      # the Projucer refers to PYTHONMAJOR
      env:
        PYTHONMAJOR: ${{ matrix.python-version }} 
      run: |
        mkdir build_release
        cmake -DCMAKE_BUILD_TYPE=Release -Bbuild_release
        make --directory=build_release